<appendix xmlns="http://docbook.org/ns/docbook"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          xmlns:xi='http://www.w3.org/2001/XInclude'
          version="5.2" xml:id="changelog">
<info>
  <?db filename="changelog"?>
  <title>Change log</title>
</info>

<para>This section documents the significant changes made in each release.
See the commits and pull requests on
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/">the repository</link> for
finer detail.</para>

<revhistory>
<revision xml:id="r300-alpha18">
<revnumber>3.0.0-alpha18</revnumber>
<date>2025-02-02</date>
<revdescription>
<itemizedlist>
<listitem><para>Upgraded to version 6.0.12 of the XML Resolver. This isn‚Äôt
completely backwards compatible with earlier releases, so attempting to use an
earlier version might not work.</para>
</listitem>
<listitem><para>Fixed <ghissue number="32"/>.
The <function>p:lookup-uri</function> function now queries the catalog
resolver.</para>
</listitem>
<listitem><para>Fixed <ghissue number="163"/>.
Added a <literal linkend="dbg-next">next</literal> command to the debugger.</para>
</listitem>
<listitem><para>Fixed <ghissue number="215"/>.
Make sure that options passed to a subpipeline are reset if the step appears in a loop.
</para>
</listitem>
<listitem><para>Fixed <ghissue number="217"/>.
Correctly handle sequences of documents on the <tag>p:xslt</tag> <port>secondary</port>
output port.</para>
</listitem>
<listitem><para>Fixed <ghissue number="218"/>.
Another XPath parsing bug. üôÅ Something more comprehensive is required.</para>
</listitem>
<listitem><para>Fixed <ghissue number="219"/>.
When a <tag class="attribute">content-type</tag> is specified on
<tag>p:document</tag>, it‚Äôs an override.</para>
</listitem>
<listitem><para>Fixed <ghissue number="220"/>.
Improved the error message used to report an unbound variable reference in
an expression.</para>
</listitem>
<listitem><para>Fixed <ghissue number="232"/>.
Resolve the Saxon configuration file URI against the base URI of the
configuration element.</para>
</listitem>
<listitem><para>Updates related to recent specification changes:</para>
  <itemizedlist>
  <listitem><para>Added a <tag>p:encode</tag> step.
  </para></listitem>
  <listitem><para>Adjusted the semantics of <tag>p:cast-content-type</tag> so that
  a <tag>c:data</tag> document is always decoded.
  </para></listitem>
  <listitem><para>Added an <option>attributes</option> option to <tag>p:pack</tag>,
  <tag>p:wrap</tag>, and <tag>p:wrap-sequence</tag>.
  </para></listitem>
  <listitem><para>Improved the semantics of text value templates in XML content.
  It‚Äôs now possible to add attributes to elements with a template.
  </para></listitem>
  </itemizedlist>
</listitem>
<listitem><para>Added a <tag>cx:collection-manager</tag> step.</para>
</listitem>
<listitem><para>Added diagramming steps (<tag>p:ditaa</tag>, <tag>p:mathml-to-svg</tag>,
and <tag>p:plantuml</tag>). These are published separately.</para>
</listitem>
<listitem><para>Added a <tag>cx:railroad</tag> step, published separately.</para>
</listitem>
<listitem><para>Improved error messages in serveral places. Improved the documentation
of errors in reference pages.</para>
</listitem>
<listitem><para>Ignore serialization properties when they are explicitly set
to the empty sequence.</para>
</listitem>
<listitem><para>Added support in <tag>p:cast-content-type</tag> for casting to and from
<code>text/x-java-properties</code>.
to the empty sequence.</para>
</listitem>
<listitem><para>Fixed a bug in <tag>p:viewport</tag> where the base URI of documents
in the viewport was incorrect.</para>
</listitem>
<listitem><para>Allow other configuration elements in the configuration file. This provides
a mechanism for steps to have their own configuration.</para>
</listitem>
<listitem><para>Improved the checking for invalid URIs.</para></listitem>
<listitem><para>Fixed a couple of bugs in the pipeline graph output. (Sometimes the
output from a compound step wasn‚Äôt correctly connected to its input.)</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha17">
<revnumber>3.0.0-alpha17</revnumber>
<date>2025-01-19</date>
<revdescription>
<itemizedlist>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/189">issue #189</link>.
Generate an XVRL report for NVDL validation.
</para>
</listitem>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/186">issue #186</link>.
Fix links to standard libraries and XProcRef.org in the reference guide.
</para>
</listitem>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/185">issue #185</link>.
Check for required inputs and options before running a pipeline.
When a top-level pipeline is run, check that required options and required
inputs have been provided. (Checking for required inputs here is an opportunity
to improve the error message.)
Keep track of the required state of options until runtime.
Within a pipeline, failing to provide a required option is a static error. But
‚Äútop level‚Äù pipelines can‚Äôt be checked before they run. When they run, it must
be possible to determine which options were declared as required.
</para>
</listitem>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/184">issue #184</link>.
Fix bugs in Schematron XVRL reporting. (Generally,
improve error reporting for validation steps.)
</para>
</listitem>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/160">issue #160</link>.
The code was over-zealous when constructing step configurations. It created a
new Saxon Configuration for every step. That‚Äôs not necessary; it‚Äôs only
necessary that each <tag>p:library</tag> and <tag>p:declare-step</tag> (and
their descendants) have a new configuration. Configurations are required at that
level because any use of <tag>p:import-functions</tag> has to be isolated.
</para>
</listitem>
<listitem>
<para>Compute a total order over subpipeline steps during graph building.
This change replaces the, in retrospect very strange, approach previously taken
where the steps were effectively unordered and at runtime each was tested to see
if it could be run. Now we work out in advance a total order such that no step
runs before any step that it depends on. (With some special cases to deal with
the when/otherwise clauses in a choose.)</para>
</listitem>
<listitem><para>Fixed bug where buffered messages (accessible through
<tag>p:pipeline-messages</tag>) could be ‚Äúnull‚Äù instead of the correct
message.</para>
</listitem>
<listitem><para>Implemented the
<tag xlink:href="https://docs.xmlcalabash.com/reference/current/cx-wait-for-update.html"
>cx:wait-for-update</tag> step.</para>
</listitem>
<listitem><para>Implemented the
<tag xlink:href="https://docs.xmlcalabash.com/reference/current/cx-until.html"
>cx:until</tag> and
<tag xlink:href="https://docs.xmlcalabash.com/reference/current/cx-while.html"
>cx:while</tag> steps.</para>
</listitem>
<listitem>
<para>Added an
‚Äú<link xlink:href="https://docs.xmlcalabash.com/userguide/current/errors.html"
>Errors and error messages</link>‚Äù chapter to the user guide.
Reworked document resolver APIs; made it possible to publish the
XVRL-to-text stylesheet in the user guide.</para>
</listitem>
<listitem>
<para>Tidy up the pipeline/graph visualization output.
Output option names for options, use the command line <option>--debug</option>
flag to control debugging output. Use <code>¬´anonymous¬ª</code> instead of the
arbitrary step ID for the root pipeline if it has no declared type.</para>
</listitem>
<listitem><para>Fixed bug in <tag class="attribute">exclude-inline-prefixes</tag> where
it was possible to generate a document that was not namespace well-formed.</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha16">
<revnumber>3.0.0-alpha16</revnumber>
<date>2025-01-15</date>
<revdescription>
<itemizedlist>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/175">issue #175</link>.
Make sure directories are created before attempting to write files.
</para>
</listitem>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/174">issue #174</link>.
Improved reporting of user-defined errors.
If a pipeline author aborts a pipeline with <tag>p:error</tag>, make sure that any details
provided are presented when the pipeline fails. (Don‚Äôt attempt to use the error
explainer, it won‚Äôt know anything about that error.)
</para>
</listitem>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/167">issue #173</link>.
The ‚Äúdetailed‚Äù option on <tag>p:directory-list</tag> didn‚Äôt work on Windows because
Windows doesn‚Äôt support POSIX file permissions. On Windows, the step succeeds but provides
slightly less detail.
</para>
</listitem>
<listitem><para>Reworked how Graphviz visualizations are created and stored. The
<option>--description</option> and <option>--graph</option> options have been replaced
with a single <option>--graphs</option> option. The new option
writes all of the descriptions to an output directory. Instead of one,
potentially huge, SVG diagram of the entire set of pipelines, there are now
distinct graphs for each pipeline with hyperlinks between them.</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha15">
<revnumber>3.0.0-alpha15</revnumber>
<date>2025-01-13</date>
<revdescription>
<itemizedlist>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/167">issue #167</link>.
Make sure that the <option linkend="cli-init">--init</option> functions are applied
to every configuration.</para>
</listitem>
<listitem><para>Fixed issues
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/164">#164</link> and
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/165">#165</link>.
Improved XVRL reporting and metadata.
</para>
</listitem>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/159">issue #159</link>.
Make sure that validity errors are reported in XVRL. Improve reports associated
with RELAX NG validation failures.</para>
</listitem>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/157">issue #157</link>.
In <tag>p:validate-with-xml-schema</tag>, ignore any errors that arise when
attempting to locate a schema at the namespace URI. (It‚Äôs not absolutely certain
that this was the cause of #157, but it‚Äôs my best guess.)</para>
</listitem>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/167">issue #156</link>
and related knock-on issues, including:</para>
<itemizedlist>
<listitem><para>Make sure that steps wait for all of their option binding inputs.
(Previous releases worked accidentally in this regard.)
</para></listitem>
<listitem><para>Make sure the base URI of an expression is always resolved
against the point of definition, not the point of use.
</para></listitem>
<listitem><para>Only apply external option bindings to
<tag>p:option</tag> instructions. (And not also <tag>p:with-option</tag> instructions!)
</para></listitem>
<listitem><para>Make sure steps declared in libraries are always fully
validated. 
</para></listitem>
<listitem><para>Fixed bug where values cast to <type>xs:integer</type> were returned as
<type>xs:decimal</type> values.
</para></listitem>
<listitem><para>Reworked how lazy bindings are managed; they‚Äôre now always documents.
</para></listitem>
<listitem><para>General improvements to logging, trace listening, message reporting,
and serialization.
</para></listitem>
</itemizedlist>
</listitem>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/153">issue #153</link>.
Setup the correct namespace context in <tag>p:if</tag>.
A <tag>p:if</tag> is rewritten as a <tag>p:choose</tag> containing a <tag>p:when</tag>; make
sure that the <tag>p:when</tag> constructed for this purpose has the right namespace
context.</para>
</listitem>
<listitem><para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/152">issue #152</link>.
Discard unused inputs on <tag>p:inline</tag> steps.
</para>
</listitem>
<listitem>
<para>When constructing SVG graph output, ignore stylesheet errors rather
than causing the processing to fail. (This hasn‚Äôt fixed the errors, but it
makes it possible to ignore them in the short term.)
</para>
</listitem>
<listitem>
<para>Found and fixed (some) issues related to how text value templates are expanded.
(There are still <link xlink:href="https://github.com/xproc/3.0-specification/issues/1131">open
questions</link>.)</para>
</listitem>
<listitem>
<para>Improved handling of <code>err:XD0011</code>. Always provide a reason.</para>
</listitem>
<listitem>
<para>Fix bug where namespace bindings on attributes could be lost</para>
</listitem>
<listitem>
<para>Attempt to manage the console output encoding.</para>
<para>There‚Äôs a new configuration file setting,
<code linkend="cc.xml-calabash">console-output-encoding</code>. When
XML Calabash writes to the console, it attempts to assure that the output is
appropriate for that encoding. There‚Äôs a bit of a messy interaction between the
new ‚Äúmessage printer‚Äù class and the existing ‚Äúmessage reporter‚Äù class. More
refactoring may be useful.</para>
</listitem>
<listitem>
<para>Added ‚Äúpiped mode‚Äù to support processing XML in a unix-style pipeline.
</para>
<para>In piped mode (<code linkend="cli-pipe">--pipe</code> or
<code linkend="cc.xml-calabash">piped-io</code>),
primary input comes
from stdin by default and the primary output goes to stdout by default. Explicit
bindings are still possible. The pretty printing associated with console output
is disabled.</para>
</listitem>
<listitem>
<para>Added a (somewhat crude) Powershell script to the distribution to run XML
Calabash on Windows.</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha14">
<revnumber>3.0.0-alpha14</revnumber>
<date>2025-01-08</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Reworked Java versions again. This release attempts to move the
requirement back to Java 11, except for the ‚Äúpolyglot‚Äù steps which require Java 17
or later.</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/144">issue #144</link>.
The XPath parser is still a little ad hoc. Also improved the error message if this
situation arises again.
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/142">issue #142</link>.
The default readable port of a step that followed a <tag>p:try</tag>, that itself
had an implicit output port, was not computed correctly.
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/141">issue #141</link>.
Make sure the continuous integration build scripts use the correct documentation paths.
(In order to make relative links between the guides easier to test, I moved the build
directories.)
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/144">issue #140</link>.
Removed the accidental restriction that <tag>p:variable</tag> was
not allowed in <tag>p:try</tag>.
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/138">issue #138</link>.
The Windows shell doesn‚Äôt support UTF-8 by default (checks calendar, yep, it
<emphasis>is</emphasis> 2025) so back to plain old US ASCII for all messages by
default. üéµsad tromboneüé∂
</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha13">
<revnumber>3.0.0-alpha13</revnumber>
<date>2025-01-07</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/134">issue #134</link>.
The last release (perhaps the last couple of releases) have accidentally
required Java 21. This release moves the requirement back to Java 17. Java 17 is
a ‚Äúlong-term-support‚Äù release from 2021 so it‚Äôs not exactly cutting edge.
Supporting Java 8, the historical favorite, is now deprecated, so it‚Äôs time to
move forward. Java 17 seems like a reasonable compromise between 11 (2018) and
21 (2023).</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/131">issue #131</link>.
Clarified documentation of the CSS and XSL formatters teps. Fixed broken links
between the user guide and the reference.
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/130">issue #130</link>.
There was a typo in the Relax NG grammar for the configuration file that caused
<code>cc:mimetype</code> to appear twice when the second occurrence should have
been <code>cc:paged-media</code>.
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/125">issue #125</link>.
Corrected the explanation of verbosity in the <option>--help</option> output.
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/124">issue #124</link>.
Updated the way the configuration is parsed so that the absence of the
<tag class="attribute">licensed</tag> attribute on the configuration isn‚Äôt interpreted as
a request for a ‚Äúnon-licensed‚Äù configuration.
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/123">issue #123</link>.
Added a namespace declaration to the tableaux for the <tag>cc:xml-calabash</tag> configuration
element.
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/122">issue #122</link>.
Added and documented the <option>--explain</option> command line argument.
(Previously, the explanation behavior was tied to the verbosity level which
doesn‚Äôt really make sense. I also fixed a bug where the stack trace was printed
twice if debug verbosity was used.)
</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha12">
<revnumber>3.0.0-alpha12</revnumber>
<date>2025-01-05</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Fixed a bug where lazily evaluated expressions might have the wrong
in-scope namespaces.</para>
</listitem>
<listitem>
<para>Fixed a bug where the schema-awareness of expressions and the schema-validity
of documents could get out of sync causing errors.</para>
</listitem>
<listitem>
<para>Fixed a bug where a spurious option was passed to visualizers established
by the configuration file.</para>
</listitem>
<listitem>
<para>Added Graphviz output to the debug log if generating SVG fails.</para>
</listitem>
<listitem>
<para>Allow the debugger breakpoint syntax to begin ‚Äúbreak at‚Äù as well as ‚Äúbreak on‚Äù.</para>
</listitem>
<listitem>
<para>Fixed an issue where the debugger was unable to inspect the document properties of
step inputs.</para>
</listitem>
<listitem>
<para>Improved the debugger breakpoint command to check that the specified breakpoint is
possible. The command will now reject attempts to set breakpoints that don‚Äôt refer to a valid
step id. The model command has been extended to print all of the possible ids in a pipeline.</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha11">
<revnumber>3.0.0-alpha11</revnumber>
<date>2025-01-05</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Tinkered with the timeout and sleep duration options in advance of some
anticipated specification changes. The sleep duration is now a number of seconds,
not milliseconds. Both values can be either a number or a string in the form
of an <type>xs:dayTimeDuration</type>.</para>
</listitem>
<listitem>
<para>Completely refactored the code that parses and serializes documents.
Added support for YAML and TOML content types.</para>
</listitem>
<listitem>
<para>Added <tag>cx:xpath</tag> and <tag>cx:polyglot</tag> steps (<tag>cx:javascript</tag>,
<tag>cx:python</tag>, etc.).</para>
</listitem>
<listitem>
<para>Bumped the Java version to 21, fixed a number of deprecation warnings.</para>
</listitem>
<listitem>
<para>Fixed a bug where <code>[p:]message</code> was <emphasis>still</emphasis> not
being handled correctly.</para>
</listitem>
<listitem>
<para>Added a <tag>cx:epubcheck</tag> step.</para>
</listitem>
<listitem>
<para>Updated assertions to support using an XProc pipeline as an assertion.</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha10">
<revnumber>3.0.0-alpha10</revnumber>
<date>2025-01-04</date>
<revdescription>
<itemizedlist>
<listitem>
<para>This release never actually happened. There was a typo in the build script.
I opted to bump the version rather than moving a published tag.
</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha9">
<revnumber>3.0.0-alpha9</revnumber>
<date>2025-01-01</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/92">issue #92</link>.
Updated the <tag>p:archive</tag>, <tag>p:archive-manifest</tag>,
and <tag>p:unarchive</tag> steps to support all of the formats
supported by the Apache Commons Compression library. The ‚Äúcreate‚Äù
command on <tag>p:archive</tag> also supports merging multiple archives together.
</para>
</listitem>
<listitem>
<para>Added a ‚Äúvisualization‚Äù API for tracking pipeline progress.
Extensively revised how <link linkend="logging">logging</link> works.
Removed the now unnecessary ‚Äúprogress‚Äù level of verbosity.</para>
<para>By default system logging only goes to the console and uses dynamic
levels. For a different configuration, use a different <link linkend="logback-file">logback.xml
configuration</link> file.</para>
</listitem>
<listitem>
<para>Fixed bugs related to <code>[p:]message</code> attributes.
Messages are now output through the message reporter at ‚Äúinfo‚Äù level,
rather than being printed directly to the console. Fixed a bug where static
messages on compound steps were not being output at all.
</para>
</listitem>
<listitem>
<para>Completely reworked how XVRL is supported. There‚Äôs now an internal model for the
report format. Conversion from SVRL to XVRL is done by constructing the XVRL model.
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/90">issue #90</link>
by correcting a typo in the SVG graphing stylesheet.
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/93">issue #93</link>
by removing the accidental restriction that <tag>p:variable</tag> was
not allowed in <tag>p:if</tag>. Hat tip to Achim for reporting that
one!
</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/96">issue #96</link>.
An option that had no default value but whose type did not allow the
empty sequence was generating a compile time error about the invalid
(default) value. The initializer now defers the error until runtime (where it
won‚Äôt happen if a value is provided for the option).
</para>
</listitem>
<listitem>
<para>Added <literal>application/epub+zip</literal>,
<literal>application/java-archive</literal>,
<literal>application/x-7z-compressed</literal>,
<literal>application/x-archive</literal>,
<literal>application/x-arj</literal>,
<literal>application/x-cpio</literal>, and
<literal>application/x-tar</literal> to the standard content type mapping.</para>
</listitem>
<listitem>
<para>Added an experimental <command>xmlcalabash.sh</command> script to the distribution.
This should make it easier to run XML Calabash with a modified classpath.
</para>
</listitem>
<listitem>
<para>Renamed a few build properties. The <code>BUILD_HASH</code> is now 
<code>BUILD_ID</code> and is more sensitive to internal builds. Renamed <code>SAXON</code>
to <code>SAXON_EDITION</code> and removed the misleading <code>SAXON_LICENSED</code> property.
(If you run PE or EE without a license, the edition reported is HE.)
</para>
</listitem>
<listitem>
<para>Attempt to detect when PE or EE is running without a license and provide a more
helpful version message.
</para>
</listitem>
<listitem>
<para>Upgraded to SchXslt 1.3.1. Upgrade to jing/trang 20241231. Upgraded a few Kotlin libraries.
Added the brotli and xz libraries to the core build.
</para>
</listitem>
<listitem>
<para>Fixed a bug where the error location information for an error was getting lost.
</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha8">
<revnumber>3.0.0-alpha8</revnumber>
<date>2024-12-28</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Fixed an issue where the command line interface used by the debugger was
always a ‚Äúdumb‚Äù terminal. It now supports history and editing keys.
</para>
</listitem>
<listitem>
<para>Improve the error messages associated with attempting to set inputs or
outputs on the command line for ports that don‚Äôt exist in the pipeline.
</para>
</listitem>
<listitem>
<para>An error is now reported if <tag class="attribute">psvi-required</tag> is true but the
processor doesn‚Äôt support XML Schema validation. (Saxon EE is required for PSVI support.)
</para>
</listitem>
<listitem>
<para>Renamed the ‚Äú<literal>schema-aware</literal>‚Äù command line option and configuration
property to ‚Äú<literal>licensed</literal>‚Äù. Cleaned up the tests for schema awareness in
several places.
</para>
</listitem>
<listitem>
<para>Added support for the <code>[p:]timeout</code> option on steps.
</para>
</listitem>
<listitem>
<para>Added support for the <literal>timeout</literal> parameter on <tag>p:http-request</tag>.
</para>
</listitem>
<listitem>
<para>Improved the error message associated with an undeclared prefix in an XPath expression.
</para>
</listitem>
<listitem>
<para>Improved the error codes reported for static errors in several places.
</para>
</listitem>
<listitem>
<para>Reworked the <interfacename>MessageReporter</interfacename> interface;
allowed one reporter to chain to another. Added a buffering reporter to keep track
of messages. By default the buffering reporter chains to the default reporter
which chains to the logging reporter. The buffering reporter holds the last 32
messages. The default reporter prints messages to the console if they have a
level that exceeds the verbosity threshold. The logging reporter sends all
messages to the Java logger.</para>
<para>There‚Äôs a new <code>message-buffer-size</code>
configuration setting to set the number of messages to buffered.</para>
</listitem>
<listitem>
<para>Added a new <tag>cx:pipeline-messages</tag> extension step that can
retrieve the messages buffered by the buffering reporter.
</para>
</listitem>
<listitem>
<para>Changed the message reporter and document manager to be unique per-pipeline,
rather than shared across multiple pipelines.</para>
</listitem>
<listitem>
<para>Fixed a bug where serialization properties on <tag>p:output</tag> were not
being applied when pipeline outputs were serialized.</para>
</listitem>
<listitem>
<para>Fixed a bug where XML Calabash was failing to detect that <tag>p:import</tag>
must precede <tag>p:input</tag> and <tag>p:output</tag>.
Fixed that error in many of the tests in the extra test suite.</para>
</listitem>
<listitem>
<para>Improved support for Schematron assertions. Assertions are now applied to non-XML
values by first performing ‚Äúcast content type‚Äù on them.
</para>
</listitem>
<listitem>
<para>Added support for a <tag class="attribute">cx:href</tag> attribute on
<tag>p:pipeinfo</tag>. When present, the processor behaves as if the referenced
document appeared where the reference appears. The <tag>p:pipeinfo</tag> must be
empty and the <tag class="attribute">cx:href</tag> must point to a
<tag>p:pipeinfo</tag> document. This makes it practical to share Schematron
assertions across pipelines.
</para>
</listitem>
<listitem>
<para>‚Äú<link linkend="upgrading-saxon">Fixed</link>‚Äù
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/74">#74</link>
by adding a hack to the manifest classpath.
</para>
</listitem>
<listitem>
<para>Fixed an obscure bug in the debug logging message associated with
<tag>p:sleep</tag>.
</para>
</listitem>
<listitem>
<para>Upgraded from SchXslt1 to SchXslt2 version 1.3.</para>
</listitem>
<listitem>
<para>Cleaned up the error reporter in many steps.
</para>
</listitem>
<listitem>
<para>Removed the defunct <code>debug</code> configuration setting.
</para>
</listitem>
<listitem>
<para>Improve the reference documentation for steps. Defer to the specification and to
Erik Siegal‚Äôs <emphasis>excellent</emphasis> <link xlink:href="https://XProcRef.org/">XProcRef</link>
for standard step descriptions.
</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha7">
<revnumber>3.0.0-alpha7</revnumber>
<date>2024-12-24</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Added the <link linkend="assertions">Schematron assertions feature</link>.
</para>
</listitem>
<listitem>
<para>Added a <command linkend="dbg-catch">catch</command> command to the
debugger to catch steps that fail. Added an option to the 
<command linkend="dbg-step">step</command> command to stop after a step executes.
</para>
</listitem>
<listitem>
<para>Fixed <link xlink:href="https://github.com/xproc/3.0-test-suite/pull/783">a bug</link>
in the way steps are handled in nested, common imports.</para>
</listitem>
<listitem>
<para>Fixed <link xlink:href="https://github.com/xproc/3.0-test-suite/pull/781">p:filter</link>
to work as expected rather than as documented. See also,
<link xlink:href="https://github.com/xproc/3.0-steps/pull/645">PR #645</link>, the documentation
fix.</para>
</listitem>
<listitem>
<para>Updated the <link linkend="tracing">trace listener</link> to record when steps fail.</para>
</listitem>
<listitem>
<para>Tinkered with the message listener to align its methods with the
<link linkend="revision-verbosity">recent changes</link> to
<option linkend="cli-verbosity">--verbosity</option>.</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha6">
<revnumber>3.0.0-alpha6</revnumber>
<date>2024-12-23</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Added <link xlink:href="debugging.html">an interactive debugger</link>.</para>
</listitem>
<listitem>
<para>Added a <link xlink:href="tracing.html">tracing feature</link>.</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/48">issue #48</link>
by supplying extension attributes to atomic steps.</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/47">issue #47</link>
by documenting the <option linkend="cli-pipeline">pipeline</option> option.</para>
</listitem>
<listitem>
<para>Added support for a
<option linkend="cli-init">--init</option> command line option to support registering
extension functions before running a pipeline.</para>
</listitem>
<listitem>
<para>Refactored the API that provides inputs to atomic steps. The inputs are now
cached by the implementation and made available when the step is run. The previous API didn‚Äôt
require that inputs be cached, but the overwhelming majority of steps do. Centralizing
that feature simplifies atomic step implementations and avoids bugs.</para>
</listitem>
<listitem>
<para>Fixed a bug where <tag>p:store</tag> could not store binary outputs.
Generally improved handling of serialized outputs.
Implemented support for the <tag linkend="cc.serialization">cc:serialization</tag>
configuration option.</para>
</listitem>
<listitem>
<para>Refactored the paged media steps. Documented the extensions supported by
<tag xlink:href="https://docs.xmlcalabash.com/reference/current/p-css-formatter.html">p:css-formatter</tag>
and
<tag xlink:href="https://docs.xmlcalabash.com/reference/current/p-xsl-formatter.html">p:xsl-formatter</tag>.
</para>
</listitem>
<listitem>
<para>Documented the <function
xlink:href="https://docs.xmlcalabash.com/reference/current/xproc-functions.html#f.system-property"
>p:system-property</function> function, including the vendor-specific property
names.</para>
</listitem>
<listitem>
<para>Refactored the logging-related configuration. Switched to the
<link xlink:href="https://logback.qos.ch/">Logback</link> backend. Changed the
<option linkend="cli-debug">--debug</option> option so that it enables debug logging.
</para>
</listitem>
<listitem xml:id="revision-verbosity">
<para>Refactored and reorganized the <option linkend="cli-verbosity">--verbosity</option>
values. They now align with debugging log levels.</para>
</listitem>
<listitem>
<para>Refactored how ‚Äúempty‚Äù is handled. Empty inputs are now addressed when the
graph model is built, not during pipeline construction. This simplifies construction
and fixed at least one bug.</para>
</listitem>
<listitem>
<para>Fixed a bug in the way the error explanations file was parsed.</para>
</listitem>
<listitem>
<para>Attempted to make sure that error messages include the location of the error.
Things are improved, though perhaps not fixed everywhere.</para>
</listitem>
<listitem>
<para>Refactored how step and model IDs are managed. The new system produces simpler,
more predictable APIs.</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha5">
<revnumber>3.0.0-alpha5</revnumber>
<date>2024-12-15</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Refactored the way context information is maintained both at
compile time and run time. This is a re-refactor of the refactor I
started back in June when I discovered that it must be possible for
the Saxon configuration for each step to be different. The problem I
discovered shortly after releasing <link linkend="r300-alpha4">alpha4</link> was that the runtime context
was still using the compile time environment when evaluating
expressions. Mostly this manifested in the wrong value for the
<literal>p:episode</literal> system property.</para>
<para>It was all a bit of a mess so I threw it out and started over. Again. It‚Äôs better now,
I think, but there‚Äôs still room for improvement.</para>
</listitem>
<listitem>
<para>Updated the serializer to make sure that XHTML documents are serialized as XML, not HTML.</para>
</listitem>
<listitem>
<para>Added a stub implementation of <function>p:lookup-uri</function>.</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/32">issue #32</link>
by adding a (debug logging) warning if an input or output port
trivially accepts no documents. That is, if it has a content-types
constraint that includes no inclusive members or if
<literal>*/*</literal> is the last exclusive member.</para>
</listitem>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/31">issue #31</link>
by amking some documentation improvements, including documenting the additional
properties accepted by <function>p:system-property</function> in the
<citetitle xlink:href="https://docs.xmlcalabash.com/reference/current/">Reference Guide</citetitle>.</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha4">
<revnumber>3.0.0-alpha4</revnumber>
<date>2024-12-07</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Resolved the remaining <tag>p:validate-with-json-schema</tag> test failures. Updated
to <link xlink:href="https://github.com/networknt/json-schema-validator">json-schema-validator</link>
version 1.5.4. This required adding a dependency on GraalVM‚Äôs polyglot JavaScript library.
</para>
</listitem>
<listitem>
<para>Updated the build script to use a more recent version of XercesImpl.</para>
</listitem>
<listitem>
<para>Fixed several bugs related to the way static options are resolved.</para>
</listitem>
<listitem>
<para>Fixed a bug where <code>[p:]inline-expand-text</code> was incorrectly controlling
AVTs in attributes on the element where it occurred.</para>
</listitem>
<listitem>
<para>Made many improvements to <tag>p:import-functions</tag> support.</para>
</listitem>
<listitem>
<para>Added <link xlink:href="https://github.com/xproc/3.0-test-suite/pull/774">special
handling</link> for <tag class="attribute">use-when</tag> on <tag>p:import</tag>.</para>
</listitem>
<listitem>
<para>Support variables in <tag class="attribute">match</tag> expressions on
<tag>p:viewport</tag>.</para>
</listitem>
<listitem>
<para>Fixed error codes for several tests. Correctly report static errors in more cases.</para>
</listitem>
<listitem>
<para>Reworked SVG output so that there‚Äôs one file for all the pipelines and
one file for all the graphs (instead of multiple files for each).</para>
</listitem>
<listitem>
<para>Added support for the <option>--step</option> option.</para>
</listitem>
<listitem>
<para>Fixed a bug in the attribute value template parser. It failed to handle
nested comments correctly.</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha3">
<revnumber>3.0.0-alpha3</revnumber>
<date>2024-12-02</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/9">issue #9</link>,
which reveals that the XPath parser is still a bit too ad hoc.</para>
</listitem>
<listitem>
<para>Fixed a couple of NVDL tests by sorting out the cache for schemas.
Updated the <tag>p:xinclude</tag> step so that it looks in the cache.
</para>
</listitem>
<listitem>
<para>Added <tag>cx:cache-add</tag> and <tag>cx:cache-delete</tag> to let pipeline
authors update the cache.</para>
</listitem>
<listitem>
<para>Made a bunch of improvements to static option handling.</para>
</listitem>
<listitem>
<para>Resolved the situation where two steps with the same type (private steps in different
libraries, for example) would not work correctly.</para>
</listitem>
<listitem>
<para>These changes resolved the remaining input, option, with-option, step-available, and
<tag>p:run</tag> tests.</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha2">
<revnumber>3.0.0-alpha2</revnumber>
<date>2024-11-26</date>
<revdescription>
<itemizedlist>
<listitem>
<para>Fixed
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/3">issue #3</link>,
<literal>[p:]message</literal> attributes were not supported on steps.
</para>
</listitem>
<listitem>
<para>Attempted to fix
<link xlink:href="https://github.com/xmlcalabash/xmlcalabash3/issues/2">issue #2</link>,
XML Calabash failed on startup on Windows. The problem, correctly identified by Martin,
was in the attempt to create a URI from a path. On Windows, paths contain <literal>\</literal>
and those are forbidden in URIs.</para>
<para>I‚Äôve adopted the solution suggested by Martin, and tested that it passes a ‚Äúsmoke test‚Äù
on Windows. But I‚Äôm not highly confident that this is the end of the Windows path issues.</para>
</listitem>
<listitem>
<para>Removed ‚Äúempty steps‚Äù from the runtime graph. These are steps that
generate no output, designed to model <tag>p:empty</tag> bindings. They clutter
the graph and I don‚Äôt think they‚Äôre required any more. An unbound input is now
‚Äúwelded shut‚Äù so that no inputs are expected.</para>
</listitem>
</itemizedlist>
</revdescription>
</revision>

<revision xml:id="r300-alpha1">
<revnumber>3.0.0-alpha1</revnumber>
<date>2024-11-24</date>
<revdescription>
<para>Initial publication.</para>
</revdescription>
</revision>
</revhistory>
</appendix>
